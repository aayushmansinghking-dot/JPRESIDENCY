<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ayushman Gaming Multiplayer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
body{
  min-height:100vh;
  background-image:url("your-image.jpg");
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  display:flex;
  justify-content:center;
  align-items:center;
  color:#f0f0f0;
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:linear-gradient(120deg, rgba(0,0,0,.4), rgba(0,30,60,.4));
  animation:bgMove 15s infinite alternate;
  z-index:-1;
}
@keyframes bgMove{
  0%{filter:hue-rotate(0deg)}
  50%{filter:hue-rotate(30deg)}
  100%{filter:hue-rotate(0deg)}
}

.page{display:none; width:100%; max-width:900px; padding:20px;}
.active{display:block;}
.card{background:rgba(0,0,0,.6); border-radius:18px; padding:25px; margin-bottom:20px; box-shadow:0 10px 25px rgba(0,0,0,.5);}
h1{font-size:3em;text-align:center;margin-bottom:20px;color:#9feaff;}
h2,h3{text-align:center;margin-bottom:15px;}
.btn{background:rgba(20,80,120,.8); color:#fff; border:none; padding:12px 28px; border-radius:25px; font-size:1.05em; cursor:pointer; transition:.3s;}
.btn:hover{background:rgba(40,120,180,.95); transform:translateY(-2px);}
input,select{width:100%; padding:12px; margin:8px 0; border-radius:10px; border:none; font-size:1em;}
</style>
</head>

<body>

<!-- PAGE 1: Player Registration -->
<div class="page active" id="page1">
  <div class="card">
    <h1>WELCOME TO<br>AAYUSHMAN GAMING</h1>
    <h2>Enter Your Name</h2>
    <input id="playerName" placeholder="Your Name">
    <button class="btn" onclick="registerPlayer()">Register</button>
    <h3 id="registeredStatus"></h3>
    <button class="btn" onclick="startGame()">Start Game (Admin)</button>
  </div>
</div>

<!-- PAGE 2: Role Reveal -->
<div class="page" id="page2">
  <div class="card">
    <h2 id="roleTitle">Your Role</h2>
    <h3 id="roleText"></h3>
    <button class="btn" onclick="nextPhase()">Next</button>
  </div>
</div>

<!-- PAGE 3: Questions -->
<div class="page" id="page3">
  <div class="card">
    <h2 id="questionTitle"></h2>
    <h3 id="questionText"></h3>
    <button class="btn" onclick="nextQuestion()">Next Question</button>
  </div>
</div>

<!-- PAGE 4: Voting -->
<div class="page" id="page4">
  <div class="card">
    <h2>Vote the Imposter</h2>
    <select id="voteSelect"></select>
    <button class="btn" onclick="submitVote()">Submit Vote</button>
  </div>
</div>

<!-- PAGE 5: Result -->
<div class="page" id="page5">
  <div class="card">
    <h1 id="resultText"></h1>
    <div id="finalList"></div>
  </div>
</div>

<script>
// ====== Firebase Config ======
const firebaseConfig = {
  apiKey: "AIzaSyCf7NR56WKNGMMog24mFWM5uyPXsH8eTB8",
  authDomain: "game-1cefd.firebaseapp.com",
  projectId: "game-1cefd",
  storageBucket: "game-1cefd.firebasestorage.app",
  messagingSenderId: "715517953311",
  appId: "1:715517953311:web:4ac079552ef762f3d79c2a",
  measurementId: "G-LXT96Y905M"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ====== Game Data ======
const characters=["ANSH","SRISHTI","KHUSHI","ISHU","AARUSH","KUNDAN","AVISHA","DABLOO","RUDRA","DAKSH","PRIYAM","SIDDHI","GOPAL","PAKO","CHUNNU","NAND","PRATAP","SUNITA","BABY","PUNAM","DOLLY","SUDHA","TUNNI"];
const questions=["Relation to character?","Maximum age of character?","Does character wear jeans?","Does character have beard?","Is character present here?"];

// ====== Local State ======
let playerID=null;
let role="";
let questionIndex=0;

// ====== Functions ======
function showPage(n){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById("page"+n).classList.add("active");
}

// ----- Register Player -----
function registerPlayer(){
  const name=document.getElementById("playerName").value.trim();
  if(!name){alert("Enter your name"); return;}
  // Push player to Firebase
  playerID=db.ref("/game/players").push().key;
  db.ref("/game/players/"+playerID).set({name:name, role:null, answered:false, vote:null});
  document.getElementById("registeredStatus").innerText="Registered successfully!";
}

// ----- Start Game (Admin) -----
function startGame(){
  db.ref("/game/players").once("value", snap=>{
    const data = snap.val();
    if(!data || Object.keys(data).length<3){alert("At least 3 players required"); return;}
    const playerIDs=Object.keys(data);
    const imposterIndex=Math.floor(Math.random()*playerIDs.length);
    const char=characters[Math.floor(Math.random()*characters.length)];
    // Assign roles
    playerIDs.forEach((id,i)=>{
      const roleText = (i===imposterIndex)?"IMPOSTER":"SAFE - "+char;
      db.ref("/game/players/"+id+"/role").set(roleText);
    });
    // Set first phase
    db.ref("/game/state").set({phase:"roleReveal"});
  });
}

// ----- Listen to Game State -----
db.ref("/game/state").on("value", snap=>{
  const state = snap.val();
  if(!state) return;
  if(state.phase==="roleReveal"){showPage(2); getRole();}
  else if(state.phase==="questions"){showPage(3); showQuestion();}
  else if(state.phase==="voting"){showPage(4); buildVoting();}
  else if(state.phase==="result"){showPage(5); showResult();}
});

// ----- Get Role for this Player -----
function getRole(){
  db.ref("/game/players/"+playerID+"/role").once("value").then(snap=>{
    role=snap.val();
    document.getElementById("roleText").innerText=role;
  });
}

// ----- Next Phase from Role Reveal -----
function nextPhase(){
  db.ref("/game/state").set({phase:"questions", currentQuestion:0});
}

// ----- Questions -----
function showQuestion(){
  document.getElementById("questionTitle").innerText="Your Question";
  const qIndex=Math.floor(Math.random()*questions.length);
  document.getElementById("questionText").innerText=questions[qIndex];
}

function nextQuestion(){
  // Move to voting after questions
  db.ref("/game/state").set({phase:"voting"});
}

// ----- Voting -----
function buildVoting(){
  db.ref("/game/players").once("value").then(snap=>{
    const data = snap.val();
    const sel = document.getElementById("voteSelect");
    sel.innerHTML="";
    Object.values(data).forEach(p=>{
      sel.innerHTML+=`<option>${p.name}</option>`;
    });
  });
}

function submitVote(){
  const voted = document.getElementById("voteSelect").value;
  db.ref("/game/players/"+playerID+"/vote").set(voted).then(()=>{
    alert("Vote submitted!");
    // Check if all votes in
    db.ref("/game/players").once("value").then(snap=>{
      const playersData = snap.val();
      const allVoted = Object.values(playersData).every(p=>p.vote);
      if(allVoted) db.ref("/game/state").set({phase:"result"});
    });
  });
}

// ----- Show Result -----
function showResult(){
  db.ref("/game/players").once("value").then(snap=>{
    const data = snap.val();
    const votesCount={};
    const playersArray=Object.values(data);
    playersArray.forEach(p=>{
      if(p.vote) votesCount[p.vote]=(votesCount[p.vote]||0)+1;
    });
    // Find max votes
    const maxVote=Math.max(...Object.values(votesCount));
    const topVoted=Object.keys(votesCount).filter(k=>votesCount[k]===maxVote);
    // Who is imposter
    const imposter = playersArray.find(p=>p.role==="IMPOSTER").name;
    let msg="";
    if(topVoted.length===1 && topVoted[0]===imposter) msg="IMPOSTER LOST — YOU WIN!";
    else if(topVoted.length>1) msg="IT'S A DRAW!";
    else msg="SORRY — IMPOSTER WINS!";
    document.getElementById("resultText").innerText=msg;
    document.getElementById("finalList").innerHTML=playersArray.map(p=>`<p>${p.name} : ${p.role}</p>`).join("");
  });
}
</script>

</body>
</html>
